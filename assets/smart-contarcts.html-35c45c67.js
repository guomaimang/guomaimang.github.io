import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{o as e,c as l,e as t}from"./app-15de74c7.js";const a={},n=t(`<h1 id="smart-contracts" tabindex="-1"><a class="header-anchor" href="#smart-contracts" aria-hidden="true">#</a> Smart Contracts</h1><h2 id="definition" tabindex="-1"><a class="header-anchor" href="#definition" aria-hidden="true">#</a> Definition</h2><p>A smart contract is a <strong>computer program</strong> executed in a <strong>secure environment</strong> that <strong>directly controls</strong> on <strong>digital assets</strong>.</p><p>这句话强调了智能合约的三个核心要素：计算机程序、安全环境和 数字资产。</p><h3 id="computer-program" tabindex="-1"><a class="header-anchor" href="#computer-program" aria-hidden="true">#</a> Computer Program</h3><p>Example: bet on an event. 这段代码展示了一个简单的智能合约逻辑：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 如果事件X发生了（条件为真）
if HAS_EVENT_X_HAPPENED() is true:
		// 则向A方发送1000单位的数字资产，
		send(party_A, 1000)
else:
		// 向B方发送1000单位的数字资产。
		send(party_B, 1000)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="secure-environment" tabindex="-1"><a class="header-anchor" href="#secure-environment" aria-hidden="true">#</a> Secure Environment</h3><p>Properties of Secure Environments</p><ul><li>Correctness of execution: The execution is done correctly, is not tampered</li><li>Integrity of code and data</li><li>Optional properties <ul><li>Confidentiality of code and data: 确保代码和数据在执行过程中不被未授权的第三方访问</li><li>Verifiability of execution「执行的可验证性」: 能够验证程序是否按照预期正确执行。</li><li>Availability for the programs running inside： 确保程序在需要时可以正常运行，不会因为外部因素而中断。</li></ul></li></ul><div class="hint-container tip"><p class="hint-container-title">Examples of Secure Environments</p><ul><li>Servers run by trusted parties</li><li>Decentralized computer network <ul><li>去中心化网络通过分散控制来提高系统的安全性和容错性。</li><li><em>e.g.</em>, blockchains</li></ul></li><li>Quasi-decentralized computer network「准去中心化计算机网络」 <ul><li>这种网络结构介于完全去中心化和完全中心化之间，通常由多个实体共同管理和维护。</li><li>这样的网络在提高安全性的同时，仍保持一定程度的集中控制。</li><li><em>e.g.</em>, consortium blockchains「联盟链」</li></ul></li><li>Servers secured by trusted hardware <ul><li><em>e.g.</em>, Intel SGX</li></ul></li></ul></div><h3 id="directly-controls" tabindex="-1"><a class="header-anchor" href="#directly-controls" aria-hidden="true">#</a> Directly Controls</h3><img src="https://pic.hanjiaming.com.cn/2024/10/10/852561a3b6ca9.png" alt="1728571136318.png" style="zoom:33%;"><h3 id="digital-assets" tabindex="-1"><a class="header-anchor" href="#digital-assets" aria-hidden="true">#</a> Digital Assets</h3><p>Example of Digital Assets</p><ul><li>Domain name</li><li>Website</li><li>Money</li><li>Anything tokenizable (<em>e.g.</em>, gold, silver, stock share, <em>etc</em>.)</li><li>Game items</li><li>Network bandwidth</li><li>Computation cycles</li><li>A broad category</li></ul><h2 id="how-smart-is-it" tabindex="-1"><a class="header-anchor" href="#how-smart-is-it" aria-hidden="true">#</a> How “smart” is it?</h2><ul><li><p>Automated processing</p><ul><li>facilitate「促进」, verify, or enforce the execution of a contract</li><li>在智能合约中，自动化处理用于执行、验证或强制执行合约条款。</li></ul></li><li><p>Trust reduction (Enforceable)</p><ul><li><p>信任减少（可执行性）是指智能合约不依赖于大量的合约执行机制</p></li><li><p>not depending on a very large number of contract enforcement mechanisms, but the secure environments:</p><p>「智能合约不依赖于大量的合约执行机制，而是依赖于安全的环境（如区块链）来确保合约的执行。」</p></li></ul></li><li><p>Trackable and irreversible「可追踪且不可逆转」</p></li><li><p>Unambiguous, terms clearly expressed in code「明确无误，用代码清楚表述」：无歧义</p><ul><li>Deterministic</li></ul></li></ul><div class="hint-container info"><p class="hint-container-title">Smart contracts vs. Legal contracts</p><p>智能合约更像是一台自动售货机「vending machine」。这意味着智能合约在预设的条件得到满足时，会自动执行，无需人为干预。</p><p>就像在自动售货机中投币后，机器自动分发商品一样，智能合约在条件满足时会自动执行条款。</p><p>智能合约遵循预先设定的规则「predetermined rules」。这些规则在合约创建时就已经定义，并通过代码固化在合约中。一旦合约部署在区块链上，这些规则就无法更改，确保了合约的执行是自动且透明的。</p><table><thead><tr><th>Legal contracts</th><th>Smart contracts</th></tr></thead><tbody><tr><td>Good at subjective claims (i.e., requiring human judgement)</td><td>Good at objective claims (i.e., mathematically evaluable)</td></tr><tr><td>High cost</td><td>Low cost</td></tr><tr><td>May require long legal process</td><td>Fast and automated</td></tr><tr><td>Relies on penalties</td><td>Relies on collateral/security deposits</td></tr><tr><td>Jurisdiction-bound (&quot;by law&quot;)</td><td>Potentially international</td></tr></tbody></table><p>智能合约依赖于抵押品/保证金来确保履行。这意味着在合约执行前，双方需要提供一定的抵押品，以确保合约的执行。</p><p>Smart contracts are not very effective for loans</p><ul><li>如果借款人有足够的资本「capital」提供流动性抵押品「liquid collatera」，那么他们一开始就不需要贷款。</li><li>流动性抵押品是指那些可以快速变现的资产，如现金或股票。</li><li>智能合约可以使用非流动性抵押品「illiquid collateral 」（如域名）。</li><li>非流动性抵押品是那些不能迅速变现的资产，需要更多时间和努力才能转换为现金。</li></ul><p>Legal contracts are not very effective when stake「利益」 is small</p><p>例如，在反垃圾邮件方面，垃圾邮件发送者「spammers」可以将自己定位在有利的司法管辖区，从而逃避检测。这意味着他们可以选择那些法律执行较为宽松的地区，从而避免法律合约的约束。</p></div><h2 id="smart-contract-based-apps" tabindex="-1"><a class="header-anchor" href="#smart-contract-based-apps" aria-hidden="true">#</a> Smart Contract based Apps</h2><ul><li>Escrow Service「托管服务」 <ul><li>托管服务是一种第三方服务，帮助买卖双方在交易过程中确保所有条件都得到满足。</li><li>第三方（托管代理）在交易完成之前保管交易物品或资金，确保双方都履行了各自的义务。</li></ul></li><li>Dispute「争议」 <ul><li>争议是指在交易过程中，一方或双方对交易的某些方面存在不同意见或不满意。</li><li>争议可能导致交易失败或需要第三方介入解决。</li></ul></li><li>Trust Mechanism「信任机制」 <ul><li>在没有信任基础的交易中，信任机制（如托管服务）是确保交易顺利进行的重要手段。</li><li>信任机制通过引入第三方来降低交易风险，确保双方遵守约定。</li></ul></li></ul><p>两个人，A和B，正在交换各自的对象X和Y。在正常情况下，A和B通过托管服务顺利交换对象。在争议情况下，B不愿意交出对象Y。</p><p>情况一：</p><ul><li>A将对象X交给E：解释：A将对象X交给托管代理E。</li><li>E将对象Y交给A：解释：托管代理E确认收到对象X后，将对象Y交给A。</li><li>E将对象X交给B：解释：托管代理E确认A收到对象Y后，将对象X交给B。</li></ul><p>情况二：</p><ul><li>A将对象X交给E：解释：A将对象X交给托管代理E。</li><li>B拒绝交出对象Y：解释：B在争议情况下不愿意交出对象Y，导致交易失败。</li></ul><h2 id="multisignature" tabindex="-1"><a class="header-anchor" href="#multisignature" aria-hidden="true">#</a> Multisignature</h2><p>要求 N 个“所有者”中的 M 个同意转让特定数字资产</p><p>多重签名（Multisignature）要求N个所有者中的M个同意才能转移特定的数字资产。</p><p>这意味着只有在满足一定数量的签名者同意的情况下，交易才能进行。这种机制提高了交易的安全性和信任度。</p><ul><li>Intra-organizational use cases</li><li>Buyer-seller with mediator (2-out-of-3), brief overview<br> 「买卖双方与中介（2-out-of-3）的多重签名方案概述。」 <ul><li>在这种方案中，买家、卖家和中介各持有一个密钥，任何两方的同意都可以完成交易。</li><li>买家将资金发送到一个包含2-out-of-3多重签名脚本的“脚本”地址。</li><li>这意味着只有在三方中的任意两方同意的情况下，资金才能被转移。</li><li>如果交易过程中没有问题，买家和卖家将签名同意将资金转移给卖家。</li><li>如果交易过程中出现争议，买家或卖家可以将资金退还给买家。这种机制提供了额外的安全保障。</li><li>在争议无法解决的情况下，中介可以介入并签名，将资金转移给应得的一方。中介的存在确保了交易的公平性和公正性。</li></ul></li></ul><p>公司A希望确保只有在三个高管中的至少两人同意的情况下才能转移公司的资金，以防止单人操作造成的风险。</p><p>如果只有一个高管可以单独操作公司的资金，存在高风险的可能性，例如高管个人失误或欺诈行为。因此，需要一种机制来确保资金转移需要多个高管的同意。</p><p>多重签名可以实现这一目标。通过设置一个 2-out-of-3 的多重签名方案，只有在三个高管中的至少两人同意的情况下，资金才能被转移。</p><p>A lot of interesting applications</p><ul><li>Complex policies depending on amount, withdrawal limit, etc.</li><li>“Dead man’s switch” or “Digital will” <ul><li>这是一种自动触发的机制，通常用于在某人去世后执行特定操作。</li><li>例如，“数字遗嘱”可以在所有者去世后自动将资产转移给指定的人。</li><li>but how to make it interact with the real-world? oracles!</li><li>预言机「oracles」可以提供外部数据，如死亡证明，以触发智能合约。</li></ul></li></ul><p>Insurance</p><ul><li>保险业可以利用智能合约自动处理理赔，减少人工干预，提高效率。</li><li>微支付可以用于支付计算服务「Micro-payments for computational services」，如文件存储、带宽和计算等。用户可以按需支付，只为实际使用的资源付费。</li></ul><div class="hint-container tip"><p class="hint-container-title">Lightning Network</p><p>闪电网络是一种基于区块链的二层协议，旨在提高交易速度和降低交易费用。</p><p>它通过建立支付通道来实现即时交易。多重签名在闪电网络中也有广泛应用，用于确保支付通道的安全性和有效性。</p></div><h2 id="decentralized-exchange" tabindex="-1"><a class="header-anchor" href="#decentralized-exchange" aria-hidden="true">#</a> Decentralized Exchange</h2><p><strong>Blockchain → Decentralization → Democracy?</strong></p><ul><li>Democratizing access to financial services <ul><li>去中心化交易所通过消除中介机构</li><li>使得更多的人能够直接参与金融交易，从而实现金融服务的民主化</li><li>这意味着更多的人可以平等地获取金融服务，而不受传统金融机构的限制。</li></ul></li><li>How do you buy foreign currencies「外币」 now? <ul><li>大多数人购买外币需要通过银行或外汇经纪商</li><li>这些中介机构通常会收取一定的手续费，并且交易过程可能比较繁琐。</li></ul></li><li>How “Sharing Economy Applications” (SEA) works? <ul><li>共享经济应用通过互联网平台让用户共享资源。</li><li>Airbnb, Uber, etc.</li></ul></li><li>Decentralized exchange is like those “SEA” <ul><li>去中心化交易所类似于共享经济应用，用户可以直接进行交易，而不需要通过中介机构。</li><li>去中心化交易所提供一个平台，让用户可以直接交换数字货币或其他资产。</li></ul></li><li>except there is no centralized server running the service <ul><li>与传统的共享经济应用不同，去中心化交易所没有一个中央服务器来运行服务。</li><li>相反，它使用区块链技术，通过分布式网络来管理和记录交易。</li></ul></li><li>but blockchain (or a Decentralized Autonomous Organization) <ul><li>去中心化交易所通常由区块链技术或去中心化自治组织（Decentralized Autonomous Organization, DAO）来运行和管理。</li><li>DAO是一种使用智能合约来自动执行规则和决策的组织，没有传统的管理层。</li></ul></li></ul><h2 id="ethereum" tabindex="-1"><a class="header-anchor" href="#ethereum" aria-hidden="true">#</a> Ethereum</h2><p>Ethereum: the first blockchain-based smart contract platform</p><p><strong>Blockchain with an expressive programming language</strong></p><ul><li>以太坊是一个区块链平台，它具有一种表达能力强的编程语言。 <ul><li>以太坊是一个区块链平台，它具有一种表达能力强的编程语言。</li><li>这种编程语言使得开发人员可以编写复杂的逻辑和规则，从而创建更强大和灵活的应用程序。</li></ul></li><li>a language making it ideal for smart contracts <ul><li>这种编程语言非常适合编写智能合约。</li><li>智能合约是一种可以在区块链上自动执行的协议，它的条款和条件直接写入代码中，从而确保了合约的自动化执行和验证。</li></ul></li><li>Smart contracts enable much more applications <ul><li>智能合约不仅可以用于简单的交易，还可以用于更复杂的应用场景，如去中心化金融（DeFi）、供应链管理、数字身份验证等。这使得以太坊平台具有广泛的应用前景。</li></ul></li><li>Most public blockchains are cryptocurrencies</li><li>motivation before &#39;16</li><li>Can only transfer coins between users</li></ul><h2 id="bitcoin" tabindex="-1"><a class="header-anchor" href="#bitcoin" aria-hidden="true">#</a> Bitcoin</h2><h3 id="bitcoin-scripting-language" tabindex="-1"><a class="header-anchor" href="#bitcoin-scripting-language" aria-hidden="true">#</a> Bitcoin Scripting Language</h3><p>比特币脚本语言受到Forth编程语言的启发。</p><ul><li>Forth是一种堆栈式编程语言，广泛应用于嵌入式系统和实时计算中。</li><li>它具有简单、灵活和高效的特点，这些特性也体现在比特币脚本语言中。</li></ul><h4 id="stack-based" tabindex="-1"><a class="header-anchor" href="#stack-based" aria-hidden="true">#</a> Stack-based</h4><ul><li>比特币脚本语言是基于栈的。</li><li>这意味着所有操作都是通过栈进行的，数据被压入堆栈（push），然后通过操作符进行处理，最后结果从堆栈中弹出（pop）。</li></ul><h4 id="simple-compact" tabindex="-1"><a class="header-anchor" href="#simple-compact" aria-hidden="true">#</a> Simple, compact</h4><ul><li>比特币脚本语言设计得非常简单和紧凑。</li><li>它包含一组有限的操作码（opcodes），每个操作码执行一个特定的操作。</li><li>这种简洁性有助于提高脚本的执行效率和安全性。</li></ul><h4 id="limits-on-time-memory-usage" tabindex="-1"><a class="header-anchor" href="#limits-on-time-memory-usage" aria-hidden="true">#</a> Limits on time/memory-usage</h4><ul><li>比特币脚本语言对时间和内存使用有严格的限制。</li><li>这是为了防止脚本执行时间过长或消耗过多资源，确保整个比特币网络的稳定和安全。</li></ul><h4 id="no-looping-not-a-turing-complete-language" tabindex="-1"><a class="header-anchor" href="#no-looping-not-a-turing-complete-language" aria-hidden="true">#</a> No looping (not a &quot;Turing-complete&quot; language)</h4><ul><li>比特币脚本语言不支持循环，因此它不是图灵完备的。</li><li>图灵完备的语言可以执行任何计算，但也可能陷入无限循环。</li><li>为了避免这种风险，比特币脚本语言限制了其计算能力，但仍然足够处理大多数交易验证任务。</li></ul><details class="hint-container details"><summary>Example</summary><p>假设Alice想要发送比特币给Bob，并希望确保只有Bob可以使用这些比特币。</p><p>Alice可以使用比特币脚本语言来创建一个支付条件，即只有Bob能够满足的条件。这个条件可以是Bob提供一个特定的公钥和签名。</p><p>比特币脚本语言允许用户定义复杂的支付条件，确保只有满足特定条件的人才能花费这些比特币。</p><ol><li>Alice创建一个交易输出，包含一个锁定脚本（scriptPubKey），要求提供Bob的公钥和签名。</li><li>Bob生成一个交易输入，包含一个解锁脚本（scriptSig），提供他的公钥和签名。</li><li>比特币网络验证解锁脚本和锁定脚本是否匹配，并确认交易。</li></ol><p>假设Alice的锁定脚本是<code>OP_DUP OP_HASH160 &lt;Bob的公钥哈希&gt; OP_EQUALVERIFY OP_CHECKSIG</code>，Bob的解锁脚本是<code>&lt;Bob的签名&gt; &lt;Bob的公钥&gt;</code>。比特币网络将执行以下步骤：</p><ol><li>将<code>&lt;Bob的签名&gt;</code>和<code>&lt;Bob的公钥&gt;</code>压入栈。</li><li>执行<code>OP_DUP</code>，复制公钥。</li><li>执行<code>OP_HASH160</code>，计算公钥的哈希值。</li><li>将计算结果与锁定脚本中的公钥哈希值比较（<code>OP_EQUALVERIFY</code>）。</li><li>验证签名（<code>OP_CHECKSIG</code>）。</li></ol></details><h3 id="bitcoin-script-instructions" tabindex="-1"><a class="header-anchor" href="#bitcoin-script-instructions" aria-hidden="true">#</a> Bitcoin Script Instructions</h3><p>比特币脚本语言总共有256个操作码，其中15个被禁用，75个被保留。</p><p>这些操作码用于执行各种操作，如数据处理、逻辑判断和加密验证。</p><ul><li>Arithmetic: 比特币脚本支持基本的算术操作，如加法、减法和乘法。这些操作可以用于处理交易中的数值计算。</li><li>If/then: 比特币脚本支持条件判断语句（If/Then），允许根据特定条件执行不同的操作。这在实现复杂的交易条件时非常有用。</li><li>Logic/data handling: 比特币脚本支持逻辑操作和数据处理，包括与、或、非等逻辑运算，以及数据的推入和弹出操作。这些功能用于控制脚本的执行流程和处理交易数据。</li><li>Support cryptography: 比特币脚本支持多种加密操作，包括哈希计算和数字签名验证。这些操作确保交易的安全性和完整性。</li><li>Hashes: 比特币脚本中常用的哈希函数包括SHA-256和RIPEMD-160，用于生成比特币地址和验证数据完整性。</li><li>(ECDSA) Signature verification: 比特币使用椭圆曲线数字签名算法（ECDSA）来生成和验证交易签名，确保交易只能由合法的私钥持有者发起。</li><li>Multi-signature verification: 比特币脚本支持多重签名验证，允许一个交易需要多个签名才能被执行。这种机制用于提高交易的安全性和灵活性。</li></ul><details class="hint-container details"><summary>Example</summary><p>假设我们有一个多重签名交易，要求三个参与者中的两个签名才能执行交易。我们需要编写一个比特币脚本来实现这一功能。</p><p>多重签名交易需要验证多个签名，这可以通过比特币脚本中的多重签名操作码来实现。我们需要将参与者的公钥和签名推入堆栈，然后使用操作码验证签名。</p><ol><li>将三个参与者的公钥推入堆栈。</li><li>指定需要的签名数量（2个）。</li><li>将签名推入堆栈。</li><li>使用OP_CHECKMULTISIG操作码验证签名。</li></ol><p>假设参与者的公钥为A、B、C，签名为S1、S2，脚本如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2 &lt;A&gt; &lt;B&gt; &lt;C&gt; 3 OP_CHECKMULTISIG
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个脚本将验证S1和S2是否对应A、B或C中的任意两个公钥。</p></details><h2 id="account-based-model" tabindex="-1"><a class="header-anchor" href="#account-based-model" aria-hidden="true">#</a> Account-based Model</h2><figure><img src="https://pic.hanjiaming.com.cn/2024/10/14/5e419a84c68e9.png" alt="1728876836366.png" tabindex="0" loading="lazy"><figcaption>1728876836366.png</figcaption></figure><h2 id="two-types-of-accounts" tabindex="-1"><a class="header-anchor" href="#two-types-of-accounts" aria-hidden="true">#</a> Two Types of “Accounts”</h2><h3 id="normal-account" tabindex="-1"><a class="header-anchor" href="#normal-account" aria-hidden="true">#</a> Normal Account</h3><ul><li>Normal account (like in Bitcoin) has balance and address<br> 「普通账户（类似于比特币）具有余额和地址」 <ul><li>与私钥相关联；外部拥有账户（EOA）。</li><li>EOA由用户的私钥控制，私钥用于签名交易和访问账户。</li></ul></li></ul><h3 id="smart-contract" tabindex="-1"><a class="header-anchor" href="#smart-contract" aria-hidden="true">#</a> Smart Contract</h3><ul><li>creatable by anyone/other account: 智能合约账户的创建不受限制，任何人都可以部署智能合约。</li><li>智能合约账户不仅包含执行逻辑的代码，还包含用于存储数据的键值对,包含 <ul><li>代码</li><li>用于合约的键值存储</li></ul></li></ul><p>The code can:</p><ul><li>send ETH to other accounts</li><li>read/write storage</li><li>call (i.e., start execution in) other contracts: 智能合约可以调用其他合约，实现模块化和可重用的代码。</li></ul><details class="hint-container details"><summary>Example</summary><p>假设我们要创建一个智能合约来管理一个简单的投票系统。用户可以通过发送以太币来投票，投票结果将存储在智能合约中。</p><p>我们需要一个智能合约账户来管理投票系统，存储投票结果，并能够接收和发送以太币。</p><ol><li>创建智能合约代码，定义投票逻辑和存储。</li><li>部署智能合约到以太坊区块链，生成智能合约账户。</li><li>用户通过发送以太币投票，智能合约接收以太币并记录投票结果。</li><li>智能合约可以读取和写入投票结果，确保数据的准确性和透明性。</li></ol><p>假设有三个候选人，用户通过发送1 ETH投票。投票结束后，智能合约读取存储的数据，显示每个候选人的得票数。</p></details><div class="hint-container note"><p class="hint-container-title">The “Hello World” of Ethereum -&gt; DNS</p><p>在这个代码片段中，<code>domains</code>是一个存储结构，它存储了域名的所有者（<code>owner</code>）和IP地址（<code>ip</code>）。这个结构被智能合约管理，所有数据都存储在区块链上。</p><figure><img src="https://pic.hanjiaming.com.cn/2024/10/14/eaae919bc4c12.png" alt="1728887154206.png" tabindex="0" loading="lazy"><figcaption>1728887154206.png</figcaption></figure></div>`,75),r=[n];function o(c,s){return e(),l("div",null,r)}const p=i(a,[["render",o],["__file","smart-contarcts.html.vue"]]);export{p as default};
