import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as s,e as t}from"./app-e7e54c71.js";const e={},p=t(`<h1 id="joining-data-with-pandas" tabindex="-1"><a class="header-anchor" href="#joining-data-with-pandas" aria-hidden="true">#</a> Joining Data with pandas</h1><p>作者：韩佳明</p><p>未经许可，禁止转载，已做版权存证</p><hr><ul><li>Tables = DataFrames</li><li>Merging = Joining</li></ul><figure><img src="https://pic.hanjiaming.com.cn/2022/05/07/d5f7c4aa03ce9.png" alt="CleanShot 2022-05-07 at 22.58.04@2x.png" tabindex="0" loading="lazy"><figcaption>CleanShot 2022-05-07 at 22.58.04@2x.png</figcaption></figure><h2 id="inner-join" tabindex="-1"><a class="header-anchor" href="#inner-join" aria-hidden="true">#</a> Inner join</h2><img src="https://pic.hanjiaming.com.cn/2022/02/03/443f1ec136655.png" alt="1643835100715.png" style="zoom:25%;"><p>指定检查列，将数据（或pair）相同的行进行连接并保留。</p><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/812d4308c5135.png" alt="1643834981023.png" tabindex="0" loading="lazy"><figcaption>1643834981023.png</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>wards_census <span class="token operator">=</span> wards<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>census<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;ward&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wards_census<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/69b14c0e2ed60.png" alt="1643835047555.png" tabindex="0" loading="lazy"><figcaption>1643835047555.png</figcaption></figure><h2 id="suffixes" tabindex="-1"><a class="header-anchor" href="#suffixes" aria-hidden="true">#</a> Suffixes</h2><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/840fac9cdcc80.png" alt="1643835285745.png" tabindex="0" loading="lazy"><figcaption>1643835285745.png</figcaption></figure><p>用于给相同的列名称加上自定义后缀以区分。</p><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/aacae5f5bb6c0.png" alt="1643835216850.png" tabindex="0" loading="lazy"><figcaption>1643835216850.png</figcaption></figure><h2 id="left-join" tabindex="-1"><a class="header-anchor" href="#left-join" aria-hidden="true">#</a> Left Join</h2><p>左侧数据全部保留，将右侧数据连接到左侧。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>wards_census <span class="token operator">=</span> wards<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>census<span class="token punctuation">,</span>how <span class="token operator">=</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;ward&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://pic.hanjiaming.com.cn/2022/02/03/1333c517c6827.png" alt="1643836148052.png" style="zoom:50%;"><img src="https://pic.hanjiaming.com.cn/2022/02/03/21ad295fc8b2d.png" alt="1643836056187.png" style="zoom:50%;"><p>right join 则反之</p><img src="https://pic.hanjiaming.com.cn/2022/02/03/e0f3a698c0247.png" alt="CleanShot 2022-02-03 at 05.09.26@2x.png" style="zoom:50%;"><h3 id="merging-a-table-to-itself" tabindex="-1"><a class="header-anchor" href="#merging-a-table-to-itself" aria-hidden="true">#</a> Merging a table to itself</h3><p>Merging a table to itself with left join</p><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/446fffe656d0c.png" alt="1643836656871.png" tabindex="0" loading="lazy"><figcaption>1643836656871.png</figcaption></figure><h2 id="outer-join" tabindex="-1"><a class="header-anchor" href="#outer-join" aria-hidden="true">#</a> Outer join</h2><img src="https://pic.hanjiaming.com.cn/2022/02/03/fdc2972e2480f.png" alt="1643836228510.png" style="zoom:50%;"><p>将左右进行连接，并保留没有被连接的行。</p><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/f1bf80262bc7a.png" alt="1643836325823.png" tabindex="0" loading="lazy"><figcaption>1643836325823.png</figcaption></figure><h2 id="自定义检查列" tabindex="-1"><a class="header-anchor" href="#自定义检查列" aria-hidden="true">#</a> 自定义检查列</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>original_sequels <span class="token operator">=</span> sequels<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>sequels<span class="token punctuation">,</span> left_on<span class="token operator">=</span><span class="token string">&#39;sequel&#39;</span><span class="token punctuation">,</span> right_on<span class="token operator">=</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> suffixes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;_org&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;_seq&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="merge-ordered" tabindex="-1"><a class="header-anchor" href="#merge-ordered" aria-hidden="true">#</a> merge_ordered()</h2><h3 id="对比" tabindex="-1"><a class="header-anchor" href="#对比" aria-hidden="true">#</a> 对比</h3><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/5c5964f95ec59.png" alt="1643838808744.png" tabindex="0" loading="lazy"><figcaption>1643838808744.png</figcaption></figure><p>注意 默认的连接方法是outer join</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pd<span class="token punctuation">.</span>merge_ordered<span class="token punctuation">(</span>appl<span class="token punctuation">,</span> mcd<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">,</span> suffixes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;_aapl&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;_mcd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill_method<span class="token operator">=</span><span class="token string">&#39;ffill&#39;</span><span class="token punctuation">)</span> <span class="token comment"># 指定空数据是用前一个值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/c0f11351a6077.png" alt="1643838945816.png" tabindex="0" loading="lazy"><figcaption>1643838945816.png</figcaption></figure><h2 id="merge-asof" tabindex="-1"><a class="header-anchor" href="#merge-asof" aria-hidden="true">#</a> merge_asof()</h2><ul><li>Similar to a merge_ordered() <strong>left join</strong></li><li>Similar features as merge_ordered()</li><li>非精准匹配</li><li>merge 的 on 的 column 必须是已经排好序的</li><li>direction 默认是 backward</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pd<span class="token punctuation">.</span>merge_asof<span class="token punctuation">(</span>visa<span class="token punctuation">,</span> ibm<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;date_time&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>suffixes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;_visa&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;_ibm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>direction<span class="token operator">=</span><span class="token string">&#39;forward&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># 匹配右边中不大于左边且最接近左边</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/cd870c6068163.png" alt="1643839163865.png" tabindex="0" loading="lazy"><figcaption>1643839163865.png</figcaption></figure><h2 id="变体应用" tabindex="-1"><a class="header-anchor" href="#变体应用" aria-hidden="true">#</a> 变体应用</h2><h3 id="semi-join" tabindex="-1"><a class="header-anchor" href="#semi-join" aria-hidden="true">#</a> semi-join</h3><img src="https://pic.hanjiaming.com.cn/2022/02/03/16a6c08f7cbee.png" alt="1643837527273.png" style="zoom:50%;"><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>genres_tracks <span class="token operator">=</span> genres<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>top_tracks<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">&#39;gid&#39;</span><span class="token punctuation">)</span>
top_genres <span class="token operator">=</span> genres<span class="token punctuation">[</span>genres<span class="token punctuation">[</span><span class="token string">&#39;gid&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>genres_tracks<span class="token punctuation">[</span><span class="token string">&#39;gid&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>top_genres<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="anti-join" tabindex="-1"><a class="header-anchor" href="#anti-join" aria-hidden="true">#</a> anti-join</h3><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/3b788bbdaa1c9.png" alt="1643837583407.png" tabindex="0" loading="lazy"><figcaption>1643837583407.png</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>genres_tracks <span class="token operator">=</span> genres<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>top_tracks<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">&#39;gid&#39;</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">&#39;left&#39;</span><span class="token punctuation">,</span> indicator<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
gid_list <span class="token operator">=</span> genres_tracks<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>genres_tracks<span class="token punctuation">[</span><span class="token string">&#39;_merge&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&#39;left_only&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;gid&#39;</span><span class="token punctuation">]</span>
non_top_genres <span class="token operator">=</span> genres<span class="token punctuation">[</span>genres<span class="token punctuation">[</span><span class="token string">&#39;gid&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>gid_list<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>non_top_genres<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="concatenate-vertically" tabindex="-1"><a class="header-anchor" href="#concatenate-vertically" aria-hidden="true">#</a> Concatenate vertically</h2><p><strong>垂直拼接</strong></p><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/3a50db8e6e9f1.png" alt="1643837717984.png" tabindex="0" loading="lazy"><figcaption>1643837717984.png</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>inv_jan<span class="token punctuation">,</span> inv_feb<span class="token punctuation">,</span> inv_mar<span class="token punctuation">]</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://pic.hanjiaming.com.cn/2022/02/03/1aeace29d36cf.png" alt="1643837798141.png" style="zoom:33%;"><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>inv_jan<span class="token punctuation">,</span> inv_feb<span class="token punctuation">,</span> inv_mar<span class="token punctuation">]</span><span class="token punctuation">,</span>ignore_index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;jan&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;feb&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;mar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://pic.hanjiaming.com.cn/2022/02/03/d556e8076db72.png" alt="1643837892698.png" style="zoom:33%;"><h3 id="sort" tabindex="-1"><a class="header-anchor" href="#sort" aria-hidden="true">#</a> sort</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>inv_jan<span class="token punctuation">,</span> inv_feb<span class="token punctuation">]</span><span class="token punctuation">,</span> sort<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="拼接保留列" tabindex="-1"><a class="header-anchor" href="#拼接保留列" aria-hidden="true">#</a> 拼接保留列</h3><p>指定参数 join，默认 仅拼接共同名称的列，</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>inv_jan<span class="token punctuation">,</span> inv_feb<span class="token punctuation">]</span><span class="token punctuation">,</span> join<span class="token operator">=</span><span class="token string">&#39;inner&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="使用-append-代替concat" tabindex="-1"><a class="header-anchor" href="#使用-append-代替concat" aria-hidden="true">#</a> 使用 append 代替concat</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>inv_jan<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>inv_feb<span class="token punctuation">,</span> inv_mar<span class="token punctuation">]</span><span class="token punctuation">,</span>ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>sort<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="有条件的连接" tabindex="-1"><a class="header-anchor" href="#有条件的连接" aria-hidden="true">#</a> 有条件的连接</h2><p>适用于横向 join和垂直的拼接</p><h3 id="为什么要有条件" tabindex="-1"><a class="header-anchor" href="#为什么要有条件" aria-hidden="true">#</a> 为什么要有条件</h3><figure><img src="https://pic.hanjiaming.com.cn/2022/02/03/f4aaf381ef6e3.png" alt="1643838478347.png" tabindex="0" loading="lazy"><figcaption>1643838478347.png</figcaption></figure><p>Why:</p><ul><li>Real world data is often NOT clean</li></ul><p>What to do:</p><ul><li>Fix incorrect data</li><li>Drop duplicate rows</li></ul><h3 id="条件参数" tabindex="-1"><a class="header-anchor" href="#条件参数" aria-hidden="true">#</a> 条件参数</h3><p>Checks if merge is of specied type</p><ul><li>&#39;one_to_one&#39;</li><li>&#39;one_to_many&#39;</li><li>&#39;many_to_one&#39;</li><li>&#39;many_to_many&#39;</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token punctuation">.</span>merge<span class="token punctuation">(</span>validate<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>即连接前先检查是否符合条件，符合条件才会连接，不符合就不连接。</p>`,76),i=[p];function o(c,l){return a(),s("div",null,i)}const d=n(e,[["render",o],["__file","Joining-Data-with-pandas.html.vue"]]);export{d as default};
